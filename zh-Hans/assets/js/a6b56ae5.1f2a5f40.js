"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[344],{3293:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>i,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>c,toc:()=>o});var s=a(4848),t=a(8453);const l={title:"golang map",slug:"/2024/golang-map",date:new Date("2024-08-17T00:00:00.000Z"),unlisted:!0},r=void 0,c={id:"2024/golang-map",title:"golang map",description:"\u672c\u6587\u53ef\u4ee5\u770b\u4f5c\u662f\u5bf9 hashmap | Go \u7a0b\u5e8f\u5458\u9762\u8bd5\u7b14\u8bd5\u5b9d\u5178 \u7684\u6574\u7406\u548c\u603b\u7ed3",source:"@site/docs/2024/golang-map.md",sourceDirName:"2024",slug:"/2024/golang-map",permalink:"/zh-Hans/2024/golang-map",draft:!1,unlisted:!0,tags:[],version:"current",lastUpdatedBy:"XBPk3T",lastUpdatedAt:1728810829e3,frontMatter:{title:"golang map",slug:"/2024/golang-map",date:"2024-08-17T00:00:00.000Z",unlisted:!0},sidebar:"zzz"},i={},o=[{value:"yaml",id:"yaml",level:2},{value:"golang map\u7684\u5b9e\u73b0\u539f\u7406",id:"golang-map\u7684\u5b9e\u73b0\u539f\u7406",level:2},{value:"\u904d\u5386\u8fc7\u7a0b",id:"\u904d\u5386\u8fc7\u7a0b",level:2},{value:"\u6269\u5bb9\u673a\u5236",id:"\u6269\u5bb9\u673a\u5236",level:2},{value:"\u7f29\u5bb9\u673a\u5236",id:"\u7f29\u5bb9\u673a\u5236",level:2},{value:"SwissMapType",id:"swissmaptype",level:2},{value:"sync.Map",id:"syncmap",level:2},{value:"ref",id:"ref",level:2}];function p(n){const e={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.admonition,{type:"tip",children:(0,s.jsxs)(e.p,{children:["\u672c\u6587\u53ef\u4ee5\u770b\u4f5c\u662f\u5bf9 ",(0,s.jsx)(e.a,{href:"https://golang.design/go-questions/map/",children:"hashmap | Go \u7a0b\u5e8f\u5458\u9762\u8bd5\u7b14\u8bd5\u5b9d\u5178"})," \u7684\u6574\u7406\u548c\u603b\u7ed3"]})}),"\n",(0,s.jsx)(e.h2,{id:"yaml",children:"yaml"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:'\n- topic: map\n  url:\n  qs:\n    - q: \u7528hashtable\u5b9e\u73b0hashmap\uff0c\u548c\u7528search-tree\u5b9e\u73b0hashmap\uff0c\u6709\u5565\u533a\u522b\uff1f\u4e3a\u5565golang, java, redis\u4f7f\u7528hashtable\u5b9e\u73b0map\uff0c\u800ccpp\u4f7f\u7528RBT\u5b9e\u73b0map\uff1f\n      x: \u8fd9\u7c7b\u95ee\u9898\u7684\u672c\u8d28\u5b9e\u9645\u4e0a\u8fd8\u662f\u6bd4\u8f83hashtable, RBT\u548ctrie-tree\n\n\n    - q: map \u5728\u904d\u5386\u65f6\uff0c\u5e76\u4e0d\u662f\u4ece 0 \u53f7 bucket \u5f00\u59cb\u904d\u5386\uff0c\u800c\u662f\u4ece\u4e00\u4e2a\u968f\u673a bucket \u7684\u968f\u673a cell \u5f00\u59cb\u904d\u5386\n    - q: \u4e3a\u4ec0\u4e48 map \u589e\u5220\u6539\u4f1a\u89e6\u53d1\u6807\u5fd7\u4f4d\uff0c\u5bfc\u81f4 panic\uff1f\n    - q: \u901a\u8fc7 hash \u51fd\u6570\u83b7\u53d6\u76ee\u6807 key \u7684\u54c8\u5e0c\uff0c\u54c8\u5e0c\u548c\u6570\u7ec4\u7684\u957f\u5ea6\u901a\u8fc7\u4f4d\u8fd0\u7b97\uff0c\u83b7\u53d6\u6570\u7ec4\u4f4d\u7f6e\u7684\u7d22\u5f15\u3002\u904d\u5386 bmap \u91cc\u7684 key\uff0c\u548c\u76ee\u6807 key \u5bf9\u6bd4\u83b7\u53d6 key \u7684\u7d22\u5f15\u3002\u6839\u636e key \u7684\u7d22\u5f15\u901a\u8fc7\u8ba1\u7b97\u504f\u79fb\u91cf\uff0c\u83b7\u53d6\u5230\u5bf9\u5e94 value\u3002\n      x: \u7528\u4f4d\u8fd0\u7b97\u8f6c\u6362\u6c42\u4f59\u64cd\u4f5c\uff0cm % n\uff0c\u5f53 `n = 1 << B` \u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u8f6c\u6362\u6210 `m & (1 << B - 1)`\n\n\n    - q: tophash \u6570\u7ec4\u7684\u8bbe\u8ba1\u52a0\u901f\u4e86 key \u7684\u67e5\u627e\u8fc7\u7a0b\uff0ctophash \u4e5f\u88ab\u590d\u7528\u6765\u6807\u8bb0\u6269\u5bb9\u64cd\u4f5c\u65f6\u7684\u72b6\u6001\n    - q: mapassign\n    - q: \u53cc\u6876, mapextra \u7528\u6765\u4f18\u5316 GC,\n    - q: hmap struct \u4e2d\u6709\u54ea\u4e9b\u662f\u4e3b\u8981\u5b57\u6bb5\uff1fhmap \u7684 extra \u6709\u5565\u7528\uff1f\n    - q: hmap \u4e2d\u7684\u8d1f\u8f7d\u56e0\u5b50 B \u662f\u4ec0\u4e48\uff1f\u4e3a\u4ec0\u4e48\u662f 6.5\uff1f\u8d1f\u8f7d\u56e0\u5b50\u5982\u4f55\u5f71\u54cdmap\u7684\u6027\u80fd\uff1f\u6ea2\u51fa\u7387\n      x: LB\u662f\u6700\u5927\u53ef\u5bb9\u7eb3\u5143\u7d20\u6570\uff0c\u7528\u6765\u8861\u91cf\u5f53\u524d\u54c8\u5e0c\u8868\u4e2d\u7a7a\u95f4\u5229\u7528\u7387\u7684\u6838\u5fc3\u6307\u6807\u3002\u662f\u56e0\u4e3a\u8d1f\u8f7d\u56e0\u5b50\u592a\u5927\u4e86\uff0c\u4f1a\u6709\u5f88\u591a\u6ea2\u51fa\u7684\u6876\uff1b\u592a\u5c0f\u4e86\uff0c\u5c31\u4f1a\u6d6a\u8d39\u5f88\u591a\u7a7a\u95f4\u3002\n\n#    - q: bmap \u662f\u4ec0\u4e48\uff1f\u4e3a\u4ec0\u4e48golang\u7684map\u8fd8\u9700\u8981bmap\uff1f bucket\n\n    - q: map\u6269\u5bb9\u673a\u5236\n\n    - q: map \u6709\u7f29\u5bb9\u673a\u5236\u5417\uff1f\n\n    - q: golang\u4e2dmap\u8fdb\u884c \u8bfb\u64cd\u4f5c \u7684\u5177\u4f53\u8fc7\u7a0b(\u67e5\u627e\u6570\u636e\u7684\u5177\u4f53\u6d41\u7a0b)?\n      x: key \u7ecf\u8fc7 hash \u540e\u5171 64 \u4f4d\uff0c\u6839\u636e hmap \u4e2d B \u7684\u503c\uff0c\u8ba1\u7b97\u5b83\u5230\u5e95\u8981\u843d\u5728\u54ea\u4e2a\u6876\u65f6\uff0c\u6876\u7684\u6570\u91cf\u4e3a 2^B\uff0c\u5982 B=5\uff0c\u90a3\u4e48\u7528 64 \u4f4d\u6700\u540e 5 \u4f4d\u8868\u793a\u7b2c\u51e0\u53f7\u6876\uff0c\u5728\u7528 hash \u503c\u7684\u9ad8 8 \u4f4d\u786e\u5b9a\u5728 bucket \u4e2d\u7684\u5b58\u50a8\u4f4d\u7f6e\uff0c\u5f53\u524d bmap \u4e2d\u7684 bucket \u672a\u627e\u5230\uff0c\u5219\u67e5\u8be2\u5bf9\u5e94\u7684 overflowbucket\uff0c\u5bf9\u5e94\u4f4d\u7f6e\u6709\u6570\u636e\u5219\u5bf9\u6bd4\u5b8c\u6574\u7684\u54c8\u5e0c\u503c\uff0c\u786e\u5b9a\u662f\u5426\u662f\u8981\u67e5\u627e\u7684\u6570\u636e\u3002\u5982\u679c\u5f53\u524d map \u5904\u4e8e\u6570\u636e\u642c\u79fb\u72b6\u6001\uff0c\u5219\u4f18\u5148\u4eba oldbuck-ets \u67e5\u627e\u3002\n\n    - q: golang\u4e2dmap\u8fdb\u884c \u5199\u64cd\u4f5c \u7684\u5177\u4f53\u8fc7\u7a0b?\n\n    - q: golang map\u662f\u600e\u4e48\u89e3\u51b3hash collision\u7684? Why?\n      x: CA\n\n    - q: "***\u80fd\u5426\u5e2e\u6211\u5bf9\u6bd4\u4e00\u4e0b golang \u7684 map \u548c redis \u7684 HashMap \u7684\u533a\u522b\uff1f\u5173\u952e\u5b57\uff1a\u53cc table\u3001\u6e10\u8fdb\u5f0f rehash\u3001\u6269\u5bb9\u6761\u4ef6\u3001\u7f29\u5bb9\u6761\u4ef6\u3001bgsave\u3001COW \u673a\u5236?***"\n      u: https://blog.csdn.net/tptpppp/article/details/103510214\n      x: \u53cc table\u3001\u6e10\u8fdb\u5f0f rehash\u3001bgsave\u3001COW \u673a\u5236\u3001\u6269\u5bb9\u6761\u4ef6\u3001\u7f29\u5bb9\u6761\u4ef6\n\n\n\n\n\n'})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:'\n    # map\u5e38\u7528\u64cd\u4f5c\n    - q: "***golang \u4fee\u6539map\u4e2d\u7684\u5143\u7d20? \u600e\u4e48\u4fee\u6539map of struct\u4e2d\u7684\u7684\u503c (\u539f\u5730\u4fee\u6539map)?***"\n      u: https://blog.csdn.net/W25679/article/details/124604637\n\n    - q: How to convert []map to []struct?\n\n    - q: map[string]interface{} to struct\n\n    - q: \u600e\u4e48\u7528map\u5b9e\u73b0\u5e76\u53d1\u8bfb\u5199?\n      x: \u6bd4\u8f83 "mutex+map" \u548c sync.Map\n\n    - q: How to check efficiently if a map contains a key in Go?\n      x: comma ok idiom (whether err/kv/chan exist, datatype detect)\n\n    - q: How to check whether the key of map exists?\n\n    - q: "***\u624b\u5199\u5b9e\u73b0 golang \u4e2d map \u7684\u6709\u5e8f\u67e5\u627e\uff0c\u4e14\u652f\u6301 add\u3001\u652f\u6301 delete\u3001\u652f\u6301\u8fed\u4ee3\uff1f\u6784\u9020\u4e00\u4e2a\u8f85\u52a9 slice***"\n      u: https://gist.github.com/xbpk3t/ddab2b9d20186ff27ec0e159e835e779\n      x: How does map read data? And the specific process for finding key, assigning key, deleting key and traversing key?\n\n    - q: slice \u548c map \u4f5c\u4e3a\u51fd\u6570\u53c2\u6570\u65f6\uff0c\u6709\u4ec0\u4e48\u533a\u522b\uff1f\n      x: |\n        \u51fd\u6570\u5185\u5bf9 map \u7684\u64cd\u4f5c\u4f1a\u5f71\u54cd map \u81ea\u8eab\uff0c\u5bf9 slice \u64cd\u4f5c\u5219\u4e0d\u4f1a\uff1b\u56e0\u4e3a map \u7684\u5e95\u5c42\u7ed3\u6784\u662f\u6307\u9488`*hmap`\uff0cslice \u7684\u5e95\u5c42\u7ed3\u6784\u662f struct\n\n        *Go \u8bed\u8a00\u4e2d\u7684\u51fd\u6570\u4f20\u53c2\u90fd\u662f\u503c\u4f20\u9012\uff0c\u5728\u51fd\u6570\u5185\u90e8\uff0c\u53c2\u6570\u4f1a\u88ab copy \u5230\u672c\u5730\u3002`*hmap`\u6307\u9488 copy \u5b8c\u4e4b\u540e\uff0c\u4ecd\u7136\u6307\u5411\u540c\u4e00\u4e2a map\uff0c\u56e0\u6b64\u51fd\u6570\u5185\u90e8\u5bf9 map \u7684\u64cd\u4f5c\u4f1a\u5f71\u54cd\u5b9e\u53c2\u3002\u800c slice \u88ab copy \u540e\uff0c\u4f1a\u6210\u4e3a\u4e00\u4e2a\u65b0\u7684 slice\uff0c\u5bf9\u5b83\u8fdb\u884c\u7684\u64cd\u4f5c\u4e0d\u4f1a\u5f71\u54cd\u5230\u5b9e\u53c2\u3002*\n\n\n'})}),"\n",(0,s.jsx)(e.h2,{id:"golang-map\u7684\u5b9e\u73b0\u539f\u7406",children:"golang map\u7684\u5b9e\u73b0\u539f\u7406"}),"\n",(0,s.jsx)(e.p,{children:"\u5728\u5f00\u59cb\u4ecb\u7ecdgolang map\u7684\u5b9e\u73b0\u539f\u7406\u4e4b\u524d\uff0c\u5148\u7528\u51e0\u4e2a\u95ee\u9898\u70ed\u70ed\u8eab\uff0c\u8c03\u52a8\u4e00\u4e0b\u6211\u4eec\u5bf9\u4e8emap\u7684\u57fa\u672c\u8ba4\u77e5"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"map\u6709\u54ea\u51e0\u79cd\u5b9e\u73b0\u65b9\u6cd5\uff1fhashtable\u548csearch-tree\u6709\u5565\u533a\u522b\uff1f\u4e3a\u5565\u76ee\u524d\u5927\u90e8\u5206\u8bed\u8a00\u90fd\u7528hashmap\u800c\u975esearch-tree?"}),"\n",(0,s.jsx)(e.li,{children:"\u5b9e\u73b0hashtable\u7684keypoints?"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.em,{children:(0,s.jsx)(e.strong,{children:"keypoints \u65e0\u975e\u662f hash func, load factor, hash-collision, \u53cc\u6876, \u6e10\u8fdb\u5f0frehash"})})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:"type hmap struct {\n count     int\n flags     uint8\n B         uint8\n noverflow uint16\n hash0     uint32\n buckets    unsafe.Pointer\n oldbuckets unsafe.Pointer\n nevacuate  uintptr\n extra *mapextra // optional fields\n}\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u7167golang map\u6e90\u7801\u5c31\u53ef\u4ee5\u770b\u5230"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"hash0 \u5c31\u662f hash func"}),"\n",(0,s.jsx)(e.li,{children:"buckets, oldbuckets \u5c31\u662f\u53cc\u6876"}),"\n",(0,s.jsx)(e.li,{children:"B \u5c31\u662f load factor"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u9664\u6b64\u4e4b\u5916\uff0c\u5c31\u662f count, flags, noverflow, nevacuate"}),"\n",(0,s.jsx)(e.p,{children:"[map.png]"}),"\n",(0,s.jsx)(e.p,{children:"[bmap-ds.png]"}),"\n",(0,s.jsx)(e.p,{children:"\u53ef\u4ee5\u770b\u5230bmap\u7684kv\u4e0d\u662f k/v/k/v/... \u8fd9\u79cd\u683c\u5f0f\uff0c\u800c\u662f k/k/v/v/... \u8fd9\u79cd\u683c\u5f0f\uff0c\u662f\u4e3a\u4e86\u8282\u7701\u5185\u5b58\u3002\u56e0\u4e3ak/v\u8fd9\u79cd\u683c\u5f0f\u7684\u8bdd\uff0c\u6bcf\u7ec4\u4e4b\u95f4\u90fd\u9700\u8981padding\uff0c\u5982\u679c k/k/v/v \u7684\u8bdd\uff0c\u5219\u6bcf\u4e2abucket\u5171\u4eab\u4e00\u4e2apadding\u5373\u53ef"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-markdown",children:"\u6bcf\u4e2a bucket \u8bbe\u8ba1\u6210\u6700\u591a\u53ea\u80fd\u653e 8 \u4e2a key-value \u5bf9\uff0c\u5982\u679c\u6709\u7b2c 9 \u4e2a key-value \u843d\u5165\u5f53\u524d\u7684 bucket\uff0c\u90a3\u5c31\u9700\u8981\u518d\u6784\u5efa\u4e00\u4e2a bucket \uff0c\u901a\u8fc7 overflow \u6307\u9488\u8fde\u63a5\u8d77\u6765\u3002\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-markdown",children:"\u54c8\u5e0c\u8868\u7684\u6bcf\u4e2a\u6876\u90fd\u53ea\u80fd\u5b58\u50a8 8 \u4e2a\u952e\u503c\u5bf9\uff0c\u4e00\u65e6\u5f53\u524d\u54c8\u5e0c\u7684\u67d0\u4e2a\u6876\u8d85\u51fa 8 \u4e2a\uff0c\u65b0\u7684\u952e\u503c\u5bf9\u5c31\u4f1a\u5b58\u50a8\u5230\u54c8\u5e0c\u7684\u6ea2\u51fa\u6876\u4e2d\u3002\u968f\u7740\u952e\u503c\u5bf9\u6570\u91cf\u7684\u589e\u52a0\uff0c\u6ea2\u51fa\u6876\u7684\u6570\u91cf\u548c\u54c8\u5e0c\u7684\u88c5\u8f7d\u56e0\u5b50\u4e5f\u4f1a\u9010\u6e10\u5347\u9ad8\uff0c\u8d85\u8fc7\u4e00\u5b9a\u8303\u56f4\u5c31\u4f1a\u89e6\u53d1\u6269\u5bb9\uff0c\u6269\u5bb9\u4f1a\u5c06\u6876\u7684\u6570\u91cf\u7ffb\u500d\uff0c\u5143\u7d20\u518d\u5206\u914d\u7684\u8fc7\u7a0b\u4e5f\u662f\u5728\u8c03\u7528\u5199\u64cd\u4f5c\u65f6\u589e\u91cf\u8fdb\u884c\u7684\uff0c\u4e0d\u4f1a\u9020\u6210\u6027\u80fd\u7684\u77ac\u65f6\u5de8\u5927\u6296\u52a8\u3002\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u6bcf\u4e2abucket(\u4e5f\u5c31\u662fbmap)\u53ea\u5b58\u50a88\u4e2akv\uff0c\u8d85\u51fa\u5c31\u653e\u5230\u65b0bucket"}),"\n",(0,s.jsx)(e.h2,{id:"\u904d\u5386\u8fc7\u7a0b",children:"\u904d\u5386\u8fc7\u7a0b"}),"\n",(0,s.jsx)(e.h2,{id:"\u6269\u5bb9\u673a\u5236",children:"\u6269\u5bb9\u673a\u5236"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-markdown",children:"\u67e5\u770b hashGrow() \u4ee5\u53ca \u6e10\u8fdb\u5f0f\u6269\u5bb9 growWork().\n\n\u5f53 map \u7684\u8d1f\u8f7d\u56e0\u5b50\u8d85\u8fc7\u9884\u8bbe\u7684\u9608\u503c\uff08\u901a\u5e38\u662f 6.5\uff09\u6216\u8005\u6ea2\u51fa\u6876\uff08overflow buckets\uff09\u6570\u91cf\u8fc7\u591a\u65f6\uff0cGo \u4f1a\u89e6\u53d1 map \u7684\u6269\u5bb9\u673a\u5236\u3002\n\n- *\u4e3a\u4ec0\u4e48\u9700\u8981\u6269\u5bb9\uff1f* \u968f\u7740 map \u4e2d\u5143\u7d20\u7684\u589e\u52a0\uff0c\u53d1\u751f\u54c8\u5e0c\u51b2\u7a81\u7684\u6982\u7387\u4f1a\u589e\u52a0\uff0cMap \u7684\u8bfb\u5199\u6027\u80fd\u4e5f\u4f1a\u4e0b\u964d\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u66f4\u591a\u7684\u6876\u548c\u66f4\u5927\u7684\u5185\u5b58\u6765\u4fdd\u8bc1 Map \u7684\u8bfb\u5199\u6027\u80fd\u3002\n- *\u5177\u4f53\u600e\u4e48\u6269\u5bb9\uff1f\u6709\u54ea\u4e9b\u6269\u5bb9\u7b56\u7565\uff1f* \u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u5f53\u88c5\u8f7d\u56e0\u5b50\u8d85\u8fc7\u67d0\u4e2a\u9608\u503c\u65f6\uff0c\u4f1a\u52a8\u6001\u5730\u589e\u52a0 Map \u957f\u5ea6\uff0c\u5b9e\u73b0\u81ea\u52a8\u6269\u5bb9\u3002map \u957f\u5ea6\u53d8\u5316\uff0c\u6240\u6709 key \u5728 map \u4e2d\u5bf9\u5e94\u7684\u7d22\u5f15\u90fd\u9700\u8981\u91cd\u65b0\u8ba1\u7b97\uff1b\u4f46\u662f\u4e00\u6b21\u6027\u5b8c\u6210\u6269\u5bb9\u7684\u6027\u80fd\u592a\u5dee\uff0c\u6240\u4ee5\u9700\u8981\u6e10\u8fdb\u5f0f\u6269\u5bb9\uff1b\n\n\n\n- `\u88c5\u8f7d\u56e0\u5b50`\u548c`\u6ea2\u51fa\u6876\u7684\u6570\u91cf`\u662f\u51b3\u5b9a\u54c8\u5e0c\u8868\u662f\u5426\u8fdb\u884c\u6269\u5bb9\u7684\u5173\u952e\u6307\u6807\uff1b\n- \u6269\u5bb9\u5b9e\u9645\u4e0a\u662f\u4ee5\u7a7a\u95f4\u6362\u65f6\u95f4\u7684\u624b\u6bb5\uff0c\u5728 map \u5c06\u8981\u6dfb\u52a0\u3001\u4fee\u6539\u6216\u8005\u5220\u9664 key \u65f6\uff0c\u90fd\u4f1a\u68c0\u67e5\u662f\u5426\u9700\u8981\u6269\u5bb9\uff1b\n- \u6269\u5bb9\u5206\u4e3a\u589e\u91cf\u6269\u5bb9\u548c\u7b49\u91cf\u6269\u5bb9\uff1b\u589e\u91cf\u6269\u5bb9\uff0c\u4f1a\u76f4\u63a5\u628a\u6876\u7684\u4e2a\u6570\u589e\u52a0\u4e00\u500d\uff0c\u628a\u539f\u6765\u4e00\u4e2a\u6876\u7684 key \u91cd\u65b0\u5206\u914d\u5230\u4e24\u4e2a\u6876\u4e2d\uff1b\u7b49\u91cf\u6269\u5bb9\uff0c\u4e0d\u4f1a\u66f4\u6539\u6876\u7684\u4e2a\u6570\uff0c\u53ea\u4f1a\u628a\u6876\u4e2d\u7684\u6570\u636e\u53d8\u5f97\u7d27\u51d1\uff1b\n- \u6269\u5bb9\u8fc7\u7a0b\u662f\u6e10\u8fdb\u5f0f\u7684\uff0c\u4e3b\u8981\u662f\u9632\u6b62\u4e00\u6b21\u6269\u5bb9\u9700\u8981\u642c\u8fc1\u592a\u591a key\uff0c\u5f15\u53d1\u6027\u80fd\u95ee\u9898\uff1b\n- \u89e6\u53d1\u6269\u5bb9\u7684\u65f6\u673a\u662f\u589e\u52a0\u4e86\u65b0\u5143\u7d20\uff0c\u6876\u642c\u8fc1\u7684\u65f6\u673a\u5219\u53d1\u751f\u5728\u8d4b\u503c\u3001\u5220\u9664\u671f\u95f4\uff0c\u6bcf\u6b21\u6700\u591a\u642c\u8fc1\u4e24\u4e2a\u6876\u3002*\u67e5\u627e\u3001\u8d4b\u503c\u3001\u5220\u9664\u7684\u4e00\u4e2a\u5f88\u6838\u5fc3\u7684\u5185\u5bb9\u662f\u5982\u4f55\u5b9a\u4f4d\u5230 key \u6240\u5728\u7684\u4f4d\u7f6e\uff0c\u9700\u8981\u91cd\u70b9\u7406\u89e3\u3002*\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u7f29\u5bb9\u673a\u5236",children:"\u7f29\u5bb9\u673a\u5236"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-markdown",children:"\u4f2a\u7f29\u5bb9\uff0c\u56e0\u4e3amap \u7684\u6269\u7f29\u5bb9\u7684\u4e3b\u8981\u533a\u522b\u5728\u4e8e hmap.B \u7684\u5bb9\u91cf\u5927\u5c0f\u6539\u53d8\uff0c\u800c\u7f29\u5bb9\u7531\u4e8e hmap.B \u538b\u6839\u6ca1\u53d8\uff0c\u5185\u5b58\u7a7a\u95f4\u7684\u5360\u7528\u4e5f\u662f\u6ca1\u6709\u53d8\u5316\u7684\uff08\u5177\u4f53\u6765\u8bf4\u5c31\u662f\uff0c\u5728\u5220\u9664\u5143\u7d20\u65f6\uff0c\u5e76\u4e0d\u4f1a\u91ca\u653e\u5185\u5b58\uff09\uff0c\u6240\u4ee5\u4e00\u5b9a\u4e0d\u8981\u5f80 golang \u7684 map \u4e2d\u585e\u5165\u592a\u591a\u6570\u636e\u3002\n\n\u82e5\u662f\u6269\u5bb9\uff0c\u5219 bigger \u4e3a 1\uff0c\u4e5f\u5c31\u662f B+1\u3002\u4ee3\u8868 hash \u8868\u5bb9\u91cf\u6269\u5927 1 \u500d\u3002\u4e0d\u6ee1\u8db3\u5c31\u662f\u7f29\u5bb9\uff0c\u4e5f\u5c31\u662f hash \u8868\u5bb9\u91cf\u4e0d\u53d8\u3002\u53ef\u4ee5\u5f97\u51fa\u7ed3\u8bba\uff1amap \u7684\u6269\u7f29\u5bb9\u7684\u4e3b\u8981\u533a\u522b\u5728\u4e8e hmap.B \u7684\u5bb9\u91cf\u5927\u5c0f\u6539\u53d8\u3002\u800c\u7f29\u5bb9\u7531\u4e8e hmap.B \u538b\u6839\u6ca1\u53d8\uff0c\u5185\u5b58\u7a7a\u95f4\u7684\u5360\u7528\u4e5f\u662f\u6ca1\u6709\u53d8\u5316\u7684\u3002\n"})}),"\n",(0,s.jsx)(e.h2,{id:"swissmaptype",children:"SwissMapType"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://groups.google.com/g/golang-checkins/c/YkzdsibwrPg?pli=1",children:"[go] all: split old and swiss map abi and compiler integration"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://go-review.googlesource.com/c/go/+/580779",children:"all: split old and swiss map abi and compiler integration (580779) \xb7 Gerrit Code Review"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"http://pekue.top/2023/03/14/tool_swissmap/",children:"SwissMap(Go\u5916\u90e8\u54c8\u5e0c\u8868)"})}),"\n",(0,s.jsx)(e.p,{children:"\u628a\u4e4b\u524d\u7684 src/runtime/hashmap.go \u62c6\u6210\u4e86 src/runtime/map_noswiss.go \u548c src/runtime/map_swiss.go \u4e24\u4e2a\uff0c\u4e3a\u4e86\u66f4\u597d\u7684compiler\u7f16\u8bd1"}),"\n",(0,s.jsx)(e.h2,{id:"syncmap",children:"sync.Map"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:'- topic: sync.Map\n  url: https://github.com/golang/go/blob/master/src/sync/map.go\n  qs:\n    - q: "***How does sync.Map implemented? \u80fd\u5426\u8ba4\u4e3async.Map\u662fread-preferring\u5462?***"\n      x: \u4f7f\u7528\u4e86\u8bfb\u5199\u5206\u79bb\u6765\u53bb\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\u7684\uff0csync.map \u7684\u6570\u636e\u7ed3\u6784\u5206\u4e3a\u8bfb map(read)\u3001\u5199 map(dirty)\u3001\u8fd8\u6709mutex\u4ee5\u53ca\u4e00\u4e2a\u8bb0\u5f55\u7a7f\u900f\u6b21\u6570\u7684\u503c(misses)\u3002\u5177\u4f53\u5b9e\u73b0\u662f\u6bcf\u6b21\u8bfb\u53d6\u90fd\u4f1a\u5148\u8bfb\u53d6\u8bfb\u90e8\u5206\u7684 kv\uff0c\u6ca1\u6709\u5219\u53bb\u8bfb\u5199\u90e8\u5206\u7684 kv(\u64cd\u4f5c\u5199\u90e8\u5206\u65f6\u90fd\u4f1a\u4e0a\u9501)\u3002\u5f53\u7a7f\u900f\u5230\u5199\u90e8\u5206\u7684\u6b21\u6570\u5927\u4e8e\u5199\u90e8\u5206\u7684\u957f\u5ea6\u65f6\uff0c\u5c31\u4f1a\u5c06\u5199\u90e8\u5206\u540c\u6b65\u5230\u8bfb\u90e8\u5206\uff0c\u5e76\u4e14\u628a\u5199\u90e8\u5206\u6e05\u7a7a\u3002\u6240\u4ee5\u591a\u534f\u7a0b\u4e0b\u4e00\u822c\u90fd\u4f1a\u5148\u6253\u5230\u65e0\u9501\u7684\u8bfb\u90e8\u5206\uff0c\u8fd9\u80fd\u4fdd\u8bc1\u8bfb\u53d6\u6027\u80fd\u3002\n    - q: "***sync.Map feats? \u9010\u4e00\u8bf4\u660e double-checking, \u8bfb\u5199\u5206\u79bb\u548c\u52a8\u6001\u8c03\u6574, \u5ef6\u8fdf\u5220\u9664(\u5728 sync.Map \u4e2d\u5220\u9664\u4e00\u4e2a\u952e\u503c\u5bf9\u5b9e\u9645\u4e0a\u53ea\u662f\u5c06\u5176\u6807\u8bb0\u4e3a\u5220\u9664\uff0c\u771f\u6b63\u7684\u5220\u9664\u64cd\u4f5c\u4f1a\u5728 read \u5347\u7ea7\u65f6\u8fdb\u884c\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u9501\u7684\u6301\u6709\u65f6\u95f4\u3002), read-preferring ***"\n      x: |\n        read map(atomic.Value), dirty map(mutex) \u4e4b\u95f4\u4e92\u76f8\u8f6c\u5316\uff0c\u5206\u522b\u5728\u4ec0\u4e48\u6837\u7684\u65f6\u673a\u4e0b\u4f1a\u8fdb\u884c\uff1fnil, normal\n        entry\u7684p\u53ef\u80fd\u7684\u72b6\u6001\uff0c\u6709\u54ea\u4e9b\uff1f\n        entry \u7684 p \u53ef\u80fd\u7684\u72b6\u6001\u5305\u62ec nil\uff08\u7a7a\u503c\uff09\u3001\u6307\u5411\u6b63\u5e38\u6570\u636e\u7684\u6307\u9488\u3001\u6307\u5411\u810f\u6570\u636e\u7684\u6307\u9488\u3001\u9501\u5b9a\u72b6\u6001\u7684\u6307\u9488\u3001\u7b49\u5f85\u72b6\u6001\u7684\u6307\u9488\u548c\u8fc7\u671f\u72b6\u6001\u7684\u6307\u9488\u3002\n\n\n    - q: Store(), Load(), Delete() \u5404\u81ea\u7684\u5b9e\u73b0\n    #        - "***Why is map not thread-safe? How to make map achieve concurrent reading and writing?***"\n    - q: "***Why is sync.Map rarely used in golang? pros and cons?***"\n      x: sync.Map\u9002\u5408\u8bfb\u591a\u5199\u5c11\u7684\u573a\u666f\uff08...\uff09\uff0c\u8fd9\u5c31\u662f\u201c\u4f7f\u7528sync.Map\u65f6\u9700\u8981\u8003\u8651\u8bfb\u5199\u6bd4\u201d\u8fd9\u4e2a\u8bf4\u6cd5\n    - q: pseudo shrink leads to mem-leak, How to resolve?\n\n'})}),"\n",(0,s.jsx)(e.h2,{id:"ref",children:"ref"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://draveness.me/golang/docs/part2-foundation/ch03-datastructure/golang-hashmap/",children:"map| Go \u8bed\u8a00\u8bbe\u8ba1\u4e0e\u5b9e\u73b0"})}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://blog.csdn.net/tptpppp/article/details/103510214",children:"Redis\u548cGo\u4e2dmap\u7684\u5f02\u540c_go\u7684map \u548c redis\u7684map\u5b9e\u73b0\u6709\u5565\u5171\u540c\u70b9\u5417-CSDN\u535a\u5ba2"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://www.cnblogs.com/williamjie/p/11205593.html",children:"redis\u6e10\u8fdb\u5f0frehash\u673a\u5236 - \u5272\u8089\u673a - \u535a\u5ba2\u56ed"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://golang.design/go-questions/interface/iface-eface/",children:"iface \u548c eface \u7684\u533a\u522b\u662f\u4ec0\u4e48 | Go \u7a0b\u5e8f\u5458\u9762\u8bd5\u7b14\u8bd5\u5b9d\u5178"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://draveness.me/golang/docs/part2-foundation/ch03-datastructure/golang-array-and-slice/",children:"Go \u8bed\u8a00\u5207\u7247\u7684\u5b9e\u73b0\u539f\u7406 | Go \u8bed\u8a00\u8bbe\u8ba1\u4e0e\u5b9e\u73b0"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://github.com/cch123/golang-notes?tab=readme-ov-file",children:"cch123/golang-notes: Go source code analysis(zh-cn)"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://github.com/cch123/golang-notes/blob/master/map.md#%E5%88%A0%E9%99%A4",children:"golang-notes/map.md at master \xb7 cch123/golang-notes"})})]})}function h(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(p,{...n})}):p(n)}},8453:(n,e,a)=>{a.d(e,{R:()=>r,x:()=>c});var s=a(6540);const t={},l=s.createContext(t);function r(n){const e=s.useContext(l);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:r(n.components),s.createElement(l.Provider,{value:e},n.children)}}}]);